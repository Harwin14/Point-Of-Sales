<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../stylesheets/style.css" rel="stylesheet">
  <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">
  <link href="/fontawesome/css/all.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
  <script src="/jquery-3.6.1.min.js"></script>

  <title>JQUERY</title>
</head>

<body class="body">
  <div class="container">
    <div class="card">
      <div class="h" >
        <div class=" text-center ">
          <h1>
            BREADS
          </h1>
          <h2>
            (Browse, Read, Edit, Add, Delete, Sort)
          </h2>
        </div>
      </div>
      <div class="card-body b">
        <table class="table table-striped">
          <tr class="c">
            <th>
              <div class="card-header text-center c">
                <h2>
                  SEARCH
                </h2>
              </div>
              <div class="card-body c">
                <form id="form-data-search">
                  <div class="row mb-3">
                    <label for="searchString" class="col-sm-2 col-form-check-label ">String</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="s-string" name="" placeholder="String">
                    </div>
                  </div>
                  <div class="row mb-3">
                    <label for="searchInteger" class="col-sm-2 col-form-check-label ">Integer</label>
                    <div class="col-sm-10">
                      <input type="number" class="form-control" id="s-integer" name="" placeholder="Integer">
                    </div>
                  </div>
                  <div class="row mb-3">
                    <label for="searchFloat" class="col-sm-2 col-form-check-label ">Float</label>
                    <div class="col-sm-10">
                      <input type="number" class="form-control" id="s-float" name="" placeholder="Float" step="0.005">
                    </div>
                  </div>
                  <div class="row mb-3">
                    <label for="searchDate" class="col-sm-2 col-form-check-label " id="s-date">Date</label>
                    <div class="col-sm-4">
                      <input type="date" class="form-control" id="s-startDate" name="" placeholder="Date">
                      <label class=" col-form-label">to</label>
                      <input type="date" class="form-control" id="s-endDate" name="" placeholder="Date">
                    </div>
                  </div>
                  <div class="row mb-3">
                    <label for="boolean" class="col-sm-2 col-form-check-label ">boolean</label>
                    <div class="col-sm-10">
                      <select id="s-boolean" name="" class="form-select">
                        <option value="" selected> Choose Boolean ... </option>
                        <option value=True>True</option>
                        <option value=False>False</option>
                      </select>
                    </div>
                  </div>

                  <div class="d-grid gap-2 d-md-block card-footer">
                    <button class="btn btn-primary " type="submit"><i class="fa-solid fa-magnifying-glass"
                        title="Search"> Search</i></button>
                    <button class="btn btn-warning" type="button" onclick="resetSearch()"><i
                        class="fa-sharp fa-solid fa-rotate-left" title="Reset"> Reset </i></button>
                  </div>

                  <br>
                </form>
              </div>
            </th>

          </tr>
        </table>
        <div class="card-header text-center ">
          <h3><strong>RESULT</strong></h3>
        </div>
        <table id="table-data" class="table table-striped card-body  text-center  ">
          <thead class="thead" id="head-table">

          </thead>
          <tbody>
          </tbody>
        </table>
        <div class="card-footer">
          
            <button type="button" class="btn btn-primary " title="Add" onclick="addData()"><i
                class="fa-regular fa-square-plus" title="Add"></i>
              ADD
            </button>
            <div class="p">
              <nav id="pagination-view" aria-label="Page navigation ">
              </nav>
            </div>
          
        </div>
      </div>
      <div class="modal fade" id="modal-form" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <form id="form-data" class="form">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Form</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                  onclick="$('#modal-form').modal('hide')">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">


                <div class="row mb-3">
                  <label for="string" class="col-sm-2 col-form-check-label ">String </label>
                  <div class="col-sm-10">
                    <input type="text" id="string" class="form-control" name="string" placeholder="String">
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="integer" class="col-sm-2 col-form-check-label ">Integer </label>
                  <div class="col-sm-10">
                    <input type="number" id="integer" class="form-control" name="integer" placeholder="Integer">
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="float" class="col-sm-2 col-form-check-label ">Float </label>
                  <div class="col-sm-10">
                    <input type="number" id="float" class="form-control" name="float" placeholder="Float" step="0.005">
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="date" class="col-sm-2 col-form-check-label ">Date </label>
                  <div class="col-sm-5">
                    <input type="date" id="date" class="form-control" name="date" placeheq.query.older="Date"
                      value='date' required>
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="boolean" class="col-sm-2 col-form-check-label ">bolean</label>
                  <div class="col-sm-10">
                    <select id="boolean" name="boolean" class="form-select" required>
                      <option value="" disabled selected>Choose boolean...</option>
                      <option value=True>True</option>
                      <option value=False>False</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-primary "><i class="fa-solid fa-floppy-disk"></i> Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal"
                  onclick="$('#modal-form').modal('hide')">Cancel</button>
              </div>
            </div>
          </form>
        </div>
      </div>

    </div>

  </div>

  <div class="modal fade" id="modal-delete" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Delete confirmation</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"
            onclick="$('#modal-delete').modal('hide')">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Are you sure to Delete this data?</p>
        </div>
        <div class="modal-footer">
          <button id="btn-deleted" type="button" class="btn btn-primary">Yes</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal"
            onclick="$('#modal-delete').modal('hide')">No</button>
        </div>
      </div>
    </div>
  </div>

  <script>

    let idEdit = null;
    let params = {
      page: 1,
      sortBy: 'string',
      sortMode: 1
    }

    const resetSearch = () => {
      $('#form-data-search').trigger('reset')
      params = {
        page: 1,
        sortBy: 'string',
        sortMode: 1
      }
      readData()
    }
    $(document).ready(function () {
      readData()
      $('#form-data').submit(function (event) {
        event.preventDefault()
        saveData()
      })

      $('#form-data-search').submit(function (event) {
        event.preventDefault()
        const string = $('#s-string').val()
        const integer = $('#s-integer').val()
        const float = $('#s-float').val()
        const startDate = $('#s-startDate').val()
        const endDate = $('#s-endDate').val()
        const boolean = $('#s-boolean').val()
        params = { ...params, string, integer, float, startDate, endDate, boolean, page: 1 }
        readData()
      })
      
      $('#table-data').on('click', '.btn-delete', function () {
        idDeleted = $(this).attr('dataid')
        $('#modal-delete').modal('show')

      })
      $('#head-table').on('click', '.btn', function () {
        params.sortBy = $(this).attr('sortBy')
        params.sortMode = $(this).attr('sortMode')
        console.log('params', params)
        readData()
      })

      $('#btn-deleted').click(function () {
        removeData(idDeleted)
        $('#modal-delete').modal('hide')
        idDeleted = null;

      })
    })

    const pagination = (page, pages) => {
      let html = `<ul class="pagination">
            <li class="page-item${page == 1 ? ' disabled' : ''}">
              <a class="page-link" href="javascript:void(0)" onclick="changePage(${page - 1})" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>`
      for (let i = 1; i <= pages; i++) {
        html += `<li class="page-item${page == i ? ' active' : ''}"><a class="page-link" href="javascript:void(0)" onclick="changePage(${i})">${i}</a></li> `
      }
      html += `<li class="page-item${page == pages ? ' disabled' : ''}">
              <a class="page-link" href="javascript:void(0)" onclick="changePage(${page + 1})" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>`
      $('#pagination-view').html(html)
    }

    const addData = () => {
      $('#modal-form').modal('show')
      idEdit = null
      $('#string').val('')
      $('#integer').val('')
      $('#float').val('')
      $('#date').val('')
      $('#boolean').val('')
    }


    const readData = () => {
      $.ajax({
        //  method: "GET",  //huruf kecil or huruf besar tak masaleuhh
        url: "/users",
        dataType: "json", //mastiin yg masuk data jd json
        data: params
      }).done(({ data, page, pages, offset }) => {
        let html = ''
        let htmlhead = ''
        htmlhead += `<tr>`

        htmlhead += `<th>No</th>`
        if (params.sortBy == 'string' && params.sortMode == 1) {
          htmlhead += `<th><button class="btn" sortby ="string" sortMode = -1>String<i class="fa-solid fa-arrow-up-a-z" style="margin-left:10px;"></i></button></th>`
        }
        else if (params.sortBy == 'string' && params.sortMode == -1) {
          htmlhead += `<th><button class="btn" sortby ="string" sortMode = 1>String<i class="fa-solid fa-arrow-up-z-a" style="margin-left:10px;"></i></button></th>`
        }
        else {
          htmlhead += `<th><button class="btn" sortby ="string" sortMode = 1>String<i class="fa-solid fa-sort" style="margin-left:10px;"></i></button></th>`
        }

        if (params.sortBy == 'integer' && params.sortMode == 1) {
          htmlhead += `<th><button class="btn" sortby ="integer" sortMode = -1>Integer<i class="fa-solid fa-arrow-up-1-9" style="margin-left:10px;"></i></button></th>`
        }
        else if (params.sortBy == 'integer' && params.sortMode == -1) {
          htmlhead += `<th><button class="btn" sortby ="integer" sortMode = 1>Integer<i class="fa-solid fa-arrow-up-9-1" style="margin-left:10px;"></i></button></th>`
        } else {
          htmlhead += `<th><button class="btn" sortby ="integer" sortMode = 1>Integer<i class="fa-solid fa-sort" style="margin-left:10px;"></i></button></th>`
        }

        if (params.sortBy == 'float' && params.sortMode == 1) {
          htmlhead += `<th><button class="btn" sortby ="float" sortMode = -1>Float<i class="fa-solid fa-sort-up" style="margin-left:10px;"></i></button></th>`
        }
        else if (params.sortBy == 'float' && params.sortMode == -1) {
          htmlhead += `<th><button class="btn" sortby ="float" sortMode = 1>Float<i class="fa-solid fa-sort-down" style="margin-left:10px;"></i></button></th>`
        } else {
          htmlhead += `<th><button class="btn" sortby ="float" sortMode = 1>Float<i class="fa-solid fa-sort" style="margin-left:10px;"></i></button></th>`
        }

        if (params.sortBy == 'date' && params.sortMode == 1) {
          htmlhead += `<th><button class="btn" sortby ="date" sortMode = -1>Date<i class="fa-solid fa-arrow-up-wide-short" style="margin-left:10px;"></i></button></th>`
        }
        else if (params.sortBy == 'date' && params.sortMode == -1) {
          htmlhead += `<th><button class="btn" sortby ="date" sortMode = 1>Date<i class="fa-solid fa-arrow-up-short-wide" style="margin-left:10px;"></i></button></th>`
        } else {
          htmlhead += `<th><button class="btn" sortby ="date" sortMode = 1>Date<i class="fa-solid fa-sort" style="margin-left:10px;"></i></button></th>`
        }

        if (params.sortBy == 'boolean' && params.sortMode == 1) {
          htmlhead += `<th><button class="btn" sortby ="boolean" sortMode = -1>Boolean<i class="fa-solid fa-xmark" style="margin-left:10px;"></i></button></th>`
        }
        else if (params.sortBy == 'boolean' && params.sortMode == -1) {
          htmlhead += `<th><button class="btn" sortby ="boolean" sortMode = 1>Boolean<i class="fa-solid fa-check" style="margin-left:10px;"></i></button></th>`
        } else {
          htmlhead += `<th><button class="btn" sortby ="boolean" sortMode = 1>Boolean<i class="fa-solid fa-sort" style="margin-left:10px;"></i></button></th>`
        }
        htmlhead += `<th>Actions</th>`
        htmlhead += `</tr>`
        //console.log(htmlhead)

        data.forEach((item, index) => {
          html += `
        <tr>
          <td>${index + 1 + offset}</td>
          <td>${item.string}</td>
          <td>${item.integer}</td>
          <td>${item.float}</td>
          <td>${moment(item.date).format('DD/MMMM/YYYY')}</td>
          <td>${item.boolean}</td>
          <td>
          <div class="d-grid gap-2 d-md-block">
              <button type="button" class="btn btn-success btn-edit" title="Edit" onclick='editData(${JSON.stringify(item)})'><i class="fa-solid fa-pencil"></i></button>
              <button type="button" class="btn btn-danger btn-delete" title="Delete" dataid="${item._id}"><i
                class="fa-solid fa-trash-can" ></i></button>
          </div>
          </td>  
        </tr>`
        })
        $('#head-table').html(htmlhead)
        $('#table-data tbody').html(html)
        pagination(page, pages)
      }).fail((err) => {
        {
          alert('gagal baca data jquery')
        }
      })
    }
    const changePage = (page) => {
      params.page = page
      readData()
    }
    const saveData = () => {
      const string = $('#string').val()
      const integer = $('#integer').val()
      const float = $('#float').val()
      const date = $('#date').val()
      const boolean = $('#boolean').val()
      if (idEdit == null) {
        $.ajax({
          method: "POST",
          url: `/users`,
          dataType: "json",
          data: { string, integer, float, date, boolean }
        }).done((data) => {
          readData()
          $('#body-table').trigger("reset")
        }).fail((err) => {
          alert('gagal add data jquery')
        })
      } else {
        $.ajax({
          method: "PUT",
          url: `/users/${idEdit}`,
          dataType: "json",
          data: { string, integer, float, date, boolean }
        }).done((data) => {
          readData()
        }).fail((err) => {
          alert('gagal edit data jquery')
        })
        idEdit = null;
      }
      $('#string').val('')
      $('#integer').val('')
      $('#float').val('')
      $('#date').val('')
      $('#boolean').val('')
      $('#modal-form').modal('hide')

    }
    const removeData = (id) => {
      $.ajax({
        method: "DELETE",
        url: `/users/${id}`,
        dataType: "json"
      }).done((data) => {
        readData()
      }).fail((err) => {
        alert('gagal delete data jquery')
      })
    }

    const editData = (data) => {
      idEdit = data._id
      $('#string').val(data.string)
      $('#integer').val(data.integer)
      $('#float').val(data.float)
      $('#date').val(moment(data.date).format("YYYY-MM-DD"))
      $('#boolean').val(data.boolean)
      $('#modal-form').modal('show')

    }
    readData()

  </script>
</body>

</html>